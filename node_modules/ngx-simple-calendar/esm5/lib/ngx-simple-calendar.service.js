/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Injectable } from '@angular/core';
import { months } from './data-models/data-calendar';
import * as i0 from "@angular/core";
var NgxSimpleCalendarService = /** @class */ (function () {
    function NgxSimpleCalendarService() {
        var _this = this;
        this.getDaysInMonth = (/**
         * @param {?} month
         * @param {?} year
         * @return {?}
         */
        function (month, year) { return new Date(year, month + 1, 0).getDate(); });
        this.getFirstDayInMonth = (/**
         * @param {?} month
         * @param {?} year
         * @return {?}
         */
        function (month, year) { return new Date(year, month, 1).getDay(); });
        this.getLastDayInMonth = (/**
         * @param {?} month
         * @param {?} year
         * @return {?}
         */
        function (month, year) { return new Date(year, month, _this.getDaysInMonth(month, year)).getDay(); });
        this.getMonthYearText = (/**
         * @param {?} monthNumber
         * @param {?} year
         * @return {?}
         */
        function (monthNumber, year) { return months.find((/**
         * @param {?} item
         * @return {?}
         */
        function (item) { return item.id === monthNumber; })).name + " " + year; });
    }
    /**
     * @param {?} month
     * @param {?} year
     * @param {?} events
     * @return {?}
     */
    NgxSimpleCalendarService.prototype.setupCalendar = /**
     * @param {?} month
     * @param {?} year
     * @param {?} events
     * @return {?}
     */
    function (month, year, events) {
        /** @type {?} */
        var firstDayInMonth = this.getFirstDayInMonth(month, year);
        /** @type {?} */
        var lastDayInMonth = this.getLastDayInMonth(month, year);
        /** @type {?} */
        var daysFromLastMonth = this.getDaysFromLastMonth(month, year, firstDayInMonth);
        /** @type {?} */
        var daysFromCurrentMonth = this.getDaysInCurrentMonth(month, year);
        /** @type {?} */
        var daysFromNextMonth = this.getDaysFromNextMonth(month, year, lastDayInMonth);
        /** @type {?} */
        var calendarData = tslib_1.__spread(daysFromLastMonth, daysFromCurrentMonth, daysFromNextMonth);
        this.markCurrentDate(calendarData);
        if (events) {
            this.addEvents(calendarData, events);
        }
        return calendarData;
    };
    /**
     * @private
     * @param {?} month
     * @param {?} year
     * @param {?} firstDayInMonth
     * @return {?}
     */
    NgxSimpleCalendarService.prototype.getDaysFromLastMonth = /**
     * @private
     * @param {?} month
     * @param {?} year
     * @param {?} firstDayInMonth
     * @return {?}
     */
    function (month, year, firstDayInMonth) {
        /** @type {?} */
        var lastMonth;
        /** @type {?} */
        var activeYear;
        /** @type {?} */
        var lastMonthDays = [];
        if ((month - 1) === -1) {
            lastMonth = 11;
            activeYear = year - 1;
        }
        else {
            lastMonth = month - 1;
            activeYear = year;
        }
        /** @type {?} */
        var daysLastMonth = this.getDaysInMonth(lastMonth, activeYear);
        /** @type {?} */
        var lastFromMonth = (firstDayInMonth === 0) ? 6 : firstDayInMonth - 1;
        for (var i = (daysLastMonth - lastFromMonth) + 1; i <= daysLastMonth; i++) {
            lastMonthDays.push(this.generatedayObject(activeYear, lastMonth, i, false));
        }
        return lastMonthDays;
    };
    /**
     * @private
     * @param {?} month
     * @param {?} year
     * @return {?}
     */
    NgxSimpleCalendarService.prototype.getDaysInCurrentMonth = /**
     * @private
     * @param {?} month
     * @param {?} year
     * @return {?}
     */
    function (month, year) {
        /** @type {?} */
        var daysInMonth = this.getDaysInMonth(month, year);
        /** @type {?} */
        var currentMonthDays = [];
        for (var i = 1; i <= daysInMonth; i++) {
            currentMonthDays.push(this.generatedayObject(year, month, i));
        }
        return currentMonthDays;
    };
    /**
     * @private
     * @param {?} month
     * @param {?} year
     * @param {?} lastDayInMonth
     * @return {?}
     */
    NgxSimpleCalendarService.prototype.getDaysFromNextMonth = /**
     * @private
     * @param {?} month
     * @param {?} year
     * @param {?} lastDayInMonth
     * @return {?}
     */
    function (month, year, lastDayInMonth) {
        /** @type {?} */
        var nextMonth;
        /** @type {?} */
        var activeYear;
        /** @type {?} */
        var lastMonthDays = [];
        if ((month + 1) === 12) {
            nextMonth = 0;
            activeYear = year + 1;
        }
        else {
            nextMonth = month + 1;
            activeYear = year;
        }
        /** @type {?} */
        var lastFromMonth = (lastDayInMonth === 0) ? 0 : 7 - lastDayInMonth;
        for (var i = 1; i <= lastFromMonth; i++) {
            lastMonthDays.push(this.generatedayObject(activeYear, nextMonth, i, false));
        }
        return lastMonthDays;
    };
    /**
     * @private
     * @param {?} calendarData
     * @return {?}
     */
    NgxSimpleCalendarService.prototype.markCurrentDate = /**
     * @private
     * @param {?} calendarData
     * @return {?}
     */
    function (calendarData) {
        /** @type {?} */
        var now = new Date();
        /** @type {?} */
        var todaysDate = now.getDate();
        /** @type {?} */
        var todaysMonth = now.getMonth();
        /** @type {?} */
        var todaysYear = now.getFullYear();
        calendarData.forEach((/**
         * @param {?} day
         * @return {?}
         */
        function (day) {
            if (day.number === todaysDate && day.month === todaysMonth && day.year === todaysYear) {
                day.today = true;
            }
        }));
    };
    /**
     * @private
     * @param {?} date
     * @return {?}
     */
    NgxSimpleCalendarService.prototype.isWeekend = /**
     * @private
     * @param {?} date
     * @return {?}
     */
    function (date) {
        /** @type {?} */
        var numberDay = date.getDay();
        return numberDay === 0 || numberDay === 6;
    };
    /**
     * @private
     * @param {?} dateTime
     * @return {?}
     */
    NgxSimpleCalendarService.prototype.getDateTimeLastOfDay = /**
     * @private
     * @param {?} dateTime
     * @return {?}
     */
    function (dateTime) {
        /** @type {?} */
        var result = new Date(dateTime.getTime());
        result.setDate(result.getDate() + 1);
        result.setMilliseconds(result.getMilliseconds() - 1);
        return result;
    };
    /**
     * @param {?} year
     * @param {?} month
     * @param {?} day
     * @param {?=} activeMonth
     * @return {?}
     */
    NgxSimpleCalendarService.prototype.generatedayObject = /**
     * @param {?} year
     * @param {?} month
     * @param {?} day
     * @param {?=} activeMonth
     * @return {?}
     */
    function (year, month, day, activeMonth) {
        if (activeMonth === void 0) { activeMonth = true; }
        /** @type {?} */
        var startDateTime = new Date(year, month, day);
        /** @type {?} */
        var endDateTime = this.getDateTimeLastOfDay(startDateTime);
        return {
            number: day,
            startDateTime: startDateTime,
            endDateTime: endDateTime,
            month: startDateTime.getMonth(),
            year: startDateTime.getFullYear(),
            weekend: this.isWeekend(startDateTime),
            today: false,
            activeMonth: activeMonth,
            events: []
        };
    };
    /**
     * @private
     * @param {?} calendarData
     * @param {?} events
     * @return {?}
     */
    NgxSimpleCalendarService.prototype.addEvents = /**
     * @private
     * @param {?} calendarData
     * @param {?} events
     * @return {?}
     */
    function (calendarData, events) {
        var _this = this;
        events.forEach((/**
         * @param {?} event
         * @return {?}
         */
        function (event) {
            if (!event.endDateTime) {
                _this.handleFullDayEvent(calendarData, event);
            }
            else {
                _this.handleEventInterval(calendarData, event);
            }
        }));
    };
    /**
     * @private
     * @param {?} calendarData
     * @param {?} event
     * @return {?}
     */
    NgxSimpleCalendarService.prototype.handleFullDayEvent = /**
     * @private
     * @param {?} calendarData
     * @param {?} event
     * @return {?}
     */
    function (calendarData, event) {
        try {
            /** @type {?} */
            var dayWithEvent = calendarData.find((/**
             * @param {?} day
             * @return {?}
             */
            function (day) {
                return day.startDateTime.getTime() <= event.startDateTime.getTime() && day.endDateTime.getTime() >= event.startDateTime.getTime();
            }));
            dayWithEvent.events.push(event);
        }
        catch (e) {
            console.log('startDateTime on event is not set');
        }
    };
    /**
     * @private
     * @param {?} calendarData
     * @param {?} event
     * @return {?}
     */
    NgxSimpleCalendarService.prototype.handleEventInterval = /**
     * @private
     * @param {?} calendarData
     * @param {?} event
     * @return {?}
     */
    function (calendarData, event) {
        try {
            /** @type {?} */
            var fromDaysInCalendar = calendarData.filter((/**
             * @param {?} day
             * @return {?}
             */
            function (day) { return day.endDateTime.getTime() >= event.startDateTime.getTime(); }));
            /** @type {?} */
            var intervalDaysInCalendar = fromDaysInCalendar.filter((/**
             * @param {?} day
             * @return {?}
             */
            function (day) {
                /** @type {?} */
                var yesterDayReferentDay = new Date(day.endDateTime.getTime());
                yesterDayReferentDay.setDate(yesterDayReferentDay.getDate() - 1);
                return yesterDayReferentDay.getTime() <= event.endDateTime.getTime();
            }));
            intervalDaysInCalendar.forEach((/**
             * @param {?} day
             * @return {?}
             */
            function (day) {
                day.events.push(event);
            }));
        }
        catch (e) {
            console.log('Error on handling event interval');
        }
    };
    NgxSimpleCalendarService.decorators = [
        { type: Injectable, args: [{
                    providedIn: 'root'
                },] }
    ];
    /** @nocollapse */
    NgxSimpleCalendarService.ctorParameters = function () { return []; };
    /** @nocollapse */ NgxSimpleCalendarService.ngInjectableDef = i0.ɵɵdefineInjectable({ factory: function NgxSimpleCalendarService_Factory() { return new NgxSimpleCalendarService(); }, token: NgxSimpleCalendarService, providedIn: "root" });
    return NgxSimpleCalendarService;
}());
export { NgxSimpleCalendarService };
if (false) {
    /** @type {?} */
    NgxSimpleCalendarService.prototype.getDaysInMonth;
    /** @type {?} */
    NgxSimpleCalendarService.prototype.getFirstDayInMonth;
    /** @type {?} */
    NgxSimpleCalendarService.prototype.getLastDayInMonth;
    /** @type {?} */
    NgxSimpleCalendarService.prototype.getMonthYearText;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmd4LXNpbXBsZS1jYWxlbmRhci5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vbmd4LXNpbXBsZS1jYWxlbmRhci8iLCJzb3VyY2VzIjpbImxpYi9uZ3gtc2ltcGxlLWNhbGVuZGFyLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzNDLE9BQU8sRUFBNkIsTUFBTSxFQUFDLE1BQU0sNkJBQTZCLENBQUM7O0FBRS9FO0lBS0U7UUFBQSxpQkFDQztRQUVELG1CQUFjOzs7OztRQUFHLFVBQUMsS0FBYSxFQUFFLElBQVksSUFBSyxPQUFBLElBQUksSUFBSSxDQUFDLElBQUksRUFBRSxLQUFLLEdBQUcsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLE9BQU8sRUFBRSxFQUF0QyxDQUFzQyxFQUFDO1FBRXpGLHVCQUFrQjs7Ozs7UUFBRyxVQUFDLEtBQWEsRUFBRSxJQUFZLElBQUssT0FBQSxJQUFJLElBQUksQ0FBQyxJQUFJLEVBQUUsS0FBSyxFQUFFLENBQUMsQ0FBQyxDQUFDLE1BQU0sRUFBRSxFQUFqQyxDQUFpQyxFQUFDO1FBRXhGLHNCQUFpQjs7Ozs7UUFBRyxVQUFDLEtBQWEsRUFBRSxJQUFZLElBQUssT0FBQSxJQUFJLElBQUksQ0FBQyxJQUFJLEVBQUUsS0FBSyxFQUFFLEtBQUksQ0FBQyxjQUFjLENBQUMsS0FBSyxFQUFFLElBQUksQ0FBQyxDQUFDLENBQUMsTUFBTSxFQUFFLEVBQWhFLENBQWdFLEVBQUM7UUFxQnRILHFCQUFnQjs7Ozs7UUFBRyxVQUFDLFdBQW1CLEVBQUUsSUFBWSxJQUFLLE9BQUcsTUFBTSxDQUFDLElBQUk7Ozs7UUFBQyxVQUFDLElBQUksSUFBSyxPQUFBLElBQUksQ0FBQyxFQUFFLEtBQUssV0FBVyxFQUF2QixDQUF1QixFQUFDLENBQUMsSUFBSSxTQUFJLElBQU0sRUFBaEUsQ0FBZ0UsRUFBQztJQTNCM0gsQ0FBQzs7Ozs7OztJQVFELGdEQUFhOzs7Ozs7SUFBYixVQUFjLEtBQWEsRUFBRSxJQUFZLEVBQUUsTUFBdUI7O1lBQzFELGVBQWUsR0FBRyxJQUFJLENBQUMsa0JBQWtCLENBQUMsS0FBSyxFQUFFLElBQUksQ0FBQzs7WUFDdEQsY0FBYyxHQUFHLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxLQUFLLEVBQUUsSUFBSSxDQUFDOztZQUVwRCxpQkFBaUIsR0FBRyxJQUFJLENBQUMsb0JBQW9CLENBQUMsS0FBSyxFQUFFLElBQUksRUFBRSxlQUFlLENBQUM7O1lBQzNFLG9CQUFvQixHQUFHLElBQUksQ0FBQyxxQkFBcUIsQ0FBQyxLQUFLLEVBQUUsSUFBSSxDQUFDOztZQUM5RCxpQkFBaUIsR0FBRyxJQUFJLENBQUMsb0JBQW9CLENBQUMsS0FBSyxFQUFFLElBQUksRUFBRSxjQUFjLENBQUM7O1lBRTFFLFlBQVksb0JBQU8saUJBQWlCLEVBQUssb0JBQW9CLEVBQUssaUJBQWlCLENBQUM7UUFFMUYsSUFBSSxDQUFDLGVBQWUsQ0FBQyxZQUFZLENBQUMsQ0FBQztRQUVuQyxJQUFJLE1BQU0sRUFBRTtZQUNWLElBQUksQ0FBQyxTQUFTLENBQUMsWUFBWSxFQUFFLE1BQU0sQ0FBQyxDQUFDO1NBQ3RDO1FBRUQsT0FBTyxZQUFZLENBQUM7SUFDdEIsQ0FBQzs7Ozs7Ozs7SUFJTyx1REFBb0I7Ozs7Ozs7SUFBNUIsVUFBNkIsS0FBYSxFQUFFLElBQVksRUFBRSxlQUF1Qjs7WUFDM0UsU0FBUzs7WUFBRSxVQUFVOztZQUNuQixhQUFhLEdBQUcsRUFBRTtRQUN4QixJQUFJLENBQUMsS0FBSyxHQUFHLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFFO1lBQ3RCLFNBQVMsR0FBRyxFQUFFLENBQUM7WUFDZixVQUFVLEdBQUcsSUFBSSxHQUFHLENBQUMsQ0FBQztTQUN2QjthQUFNO1lBQ0wsU0FBUyxHQUFHLEtBQUssR0FBRyxDQUFDLENBQUM7WUFDdEIsVUFBVSxHQUFHLElBQUksQ0FBQztTQUNuQjs7WUFFSyxhQUFhLEdBQUcsSUFBSSxDQUFDLGNBQWMsQ0FBQyxTQUFTLEVBQUUsVUFBVSxDQUFDOztZQUMxRCxhQUFhLEdBQUcsQ0FBQyxlQUFlLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsZUFBZSxHQUFHLENBQUM7UUFFdkUsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLGFBQWEsR0FBRyxhQUFhLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxJQUFJLGFBQWEsRUFBRSxDQUFDLEVBQUUsRUFBRTtZQUN6RSxhQUFhLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxVQUFVLEVBQUUsU0FBUyxFQUFFLENBQUMsRUFBRSxLQUFLLENBQUMsQ0FBQyxDQUFDO1NBQzdFO1FBRUQsT0FBTyxhQUFhLENBQUM7SUFDdkIsQ0FBQzs7Ozs7OztJQUVPLHdEQUFxQjs7Ozs7O0lBQTdCLFVBQThCLEtBQUssRUFBRSxJQUFJOztZQUNqQyxXQUFXLEdBQUcsSUFBSSxDQUFDLGNBQWMsQ0FBQyxLQUFLLEVBQUUsSUFBSSxDQUFDOztZQUM5QyxnQkFBZ0IsR0FBRyxFQUFFO1FBRTNCLEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsSUFBSSxXQUFXLEVBQUUsQ0FBQyxFQUFFLEVBQUU7WUFDckMsZ0JBQWdCLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxJQUFJLEVBQUUsS0FBSyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUM7U0FDL0Q7UUFFRCxPQUFPLGdCQUFnQixDQUFDO0lBQzFCLENBQUM7Ozs7Ozs7O0lBRU8sdURBQW9COzs7Ozs7O0lBQTVCLFVBQTZCLEtBQWEsRUFBRSxJQUFZLEVBQUUsY0FBc0I7O1lBQzFFLFNBQVM7O1lBQUUsVUFBVTs7WUFFbkIsYUFBYSxHQUFHLEVBQUU7UUFDeEIsSUFBSSxDQUFDLEtBQUssR0FBRyxDQUFDLENBQUMsS0FBSyxFQUFFLEVBQUU7WUFDdEIsU0FBUyxHQUFHLENBQUMsQ0FBQztZQUNkLFVBQVUsR0FBRyxJQUFJLEdBQUcsQ0FBQyxDQUFDO1NBQ3ZCO2FBQU07WUFDTCxTQUFTLEdBQUcsS0FBSyxHQUFHLENBQUMsQ0FBQztZQUN0QixVQUFVLEdBQUcsSUFBSSxDQUFDO1NBQ25COztZQUVLLGFBQWEsR0FBRyxDQUFDLGNBQWMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsY0FBYztRQUVyRSxLQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLElBQUksYUFBYSxFQUFFLENBQUMsRUFBRSxFQUFFO1lBQ3ZDLGFBQWEsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLGlCQUFpQixDQUFDLFVBQVUsRUFBRSxTQUFTLEVBQUUsQ0FBQyxFQUFFLEtBQUssQ0FBQyxDQUFDLENBQUM7U0FDN0U7UUFFRCxPQUFPLGFBQWEsQ0FBQztJQUN2QixDQUFDOzs7Ozs7SUFFTyxrREFBZTs7Ozs7SUFBdkIsVUFBd0IsWUFBMkI7O1lBQzNDLEdBQUcsR0FBRyxJQUFJLElBQUksRUFBRTs7WUFDaEIsVUFBVSxHQUFHLEdBQUcsQ0FBQyxPQUFPLEVBQUU7O1lBQzFCLFdBQVcsR0FBRyxHQUFHLENBQUMsUUFBUSxFQUFFOztZQUM1QixVQUFVLEdBQUcsR0FBRyxDQUFDLFdBQVcsRUFBRTtRQUVwQyxZQUFZLENBQUMsT0FBTzs7OztRQUFDLFVBQUMsR0FBRztZQUN2QixJQUFJLEdBQUcsQ0FBQyxNQUFNLEtBQUssVUFBVSxJQUFJLEdBQUcsQ0FBQyxLQUFLLEtBQUssV0FBVyxJQUFJLEdBQUcsQ0FBQyxJQUFJLEtBQUssVUFBVSxFQUFFO2dCQUNyRixHQUFHLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQzthQUNsQjtRQUNILENBQUMsRUFBQyxDQUFDO0lBQ0wsQ0FBQzs7Ozs7O0lBRU8sNENBQVM7Ozs7O0lBQWpCLFVBQWtCLElBQVU7O1lBQ3BCLFNBQVMsR0FBRyxJQUFJLENBQUMsTUFBTSxFQUFFO1FBQy9CLE9BQU8sU0FBUyxLQUFLLENBQUMsSUFBSSxTQUFTLEtBQUssQ0FBQyxDQUFDO0lBQzVDLENBQUM7Ozs7OztJQUVPLHVEQUFvQjs7Ozs7SUFBNUIsVUFBNkIsUUFBYzs7WUFDbkMsTUFBTSxHQUFHLElBQUksSUFBSSxDQUFDLFFBQVEsQ0FBQyxPQUFPLEVBQUUsQ0FBQztRQUMzQyxNQUFNLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxPQUFPLEVBQUUsR0FBRyxDQUFDLENBQUMsQ0FBQztRQUNyQyxNQUFNLENBQUMsZUFBZSxDQUFDLE1BQU0sQ0FBQyxlQUFlLEVBQUUsR0FBRyxDQUFDLENBQUMsQ0FBQztRQUNyRCxPQUFPLE1BQU0sQ0FBQztJQUNoQixDQUFDOzs7Ozs7OztJQUVELG9EQUFpQjs7Ozs7OztJQUFqQixVQUFrQixJQUFZLEVBQUUsS0FBYSxFQUFFLEdBQVcsRUFBRSxXQUEyQjtRQUEzQiw0QkFBQSxFQUFBLGtCQUEyQjs7WUFDL0UsYUFBYSxHQUFHLElBQUksSUFBSSxDQUFDLElBQUksRUFBRSxLQUFLLEVBQUUsR0FBRyxDQUFDOztZQUMxQyxXQUFXLEdBQUcsSUFBSSxDQUFDLG9CQUFvQixDQUFDLGFBQWEsQ0FBQztRQUM1RCxPQUFPO1lBQ0wsTUFBTSxFQUFFLEdBQUc7WUFDWCxhQUFhLGVBQUE7WUFDYixXQUFXLGFBQUE7WUFDWCxLQUFLLEVBQUUsYUFBYSxDQUFDLFFBQVEsRUFBRTtZQUMvQixJQUFJLEVBQUUsYUFBYSxDQUFDLFdBQVcsRUFBRTtZQUNqQyxPQUFPLEVBQUUsSUFBSSxDQUFDLFNBQVMsQ0FBQyxhQUFhLENBQUM7WUFDdEMsS0FBSyxFQUFFLEtBQUs7WUFDWixXQUFXLGFBQUE7WUFDWCxNQUFNLEVBQUUsRUFBRTtTQUNYLENBQUM7SUFDSixDQUFDOzs7Ozs7O0lBRU8sNENBQVM7Ozs7OztJQUFqQixVQUFrQixZQUEyQixFQUFFLE1BQXVCO1FBQXRFLGlCQVFDO1FBUEMsTUFBTSxDQUFDLE9BQU87Ozs7UUFBQyxVQUFDLEtBQW9CO1lBQ2xDLElBQUksQ0FBQyxLQUFLLENBQUMsV0FBVyxFQUFFO2dCQUN0QixLQUFJLENBQUMsa0JBQWtCLENBQUMsWUFBWSxFQUFFLEtBQUssQ0FBQyxDQUFDO2FBQzlDO2lCQUFNO2dCQUNMLEtBQUksQ0FBQyxtQkFBbUIsQ0FBQyxZQUFZLEVBQUUsS0FBSyxDQUFDLENBQUM7YUFDL0M7UUFDSCxDQUFDLEVBQUMsQ0FBQztJQUNMLENBQUM7Ozs7Ozs7SUFFTyxxREFBa0I7Ozs7OztJQUExQixVQUEyQixZQUEyQixFQUFFLEtBQW9CO1FBQzFFLElBQUk7O2dCQUNJLFlBQVksR0FBRyxZQUFZLENBQUMsSUFBSTs7OztZQUFDLFVBQUMsR0FBRztnQkFDekMsT0FBTyxHQUFHLENBQUMsYUFBYSxDQUFDLE9BQU8sRUFBRSxJQUFJLEtBQUssQ0FBQyxhQUFhLENBQUMsT0FBTyxFQUFFLElBQUksR0FBRyxDQUFDLFdBQVcsQ0FBQyxPQUFPLEVBQUUsSUFBSSxLQUFLLENBQUMsYUFBYSxDQUFDLE9BQU8sRUFBRSxDQUFDO1lBQ3BJLENBQUMsRUFBQztZQUNGLFlBQVksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO1NBQ2pDO1FBQUMsT0FBTyxDQUFDLEVBQUU7WUFDVixPQUFPLENBQUMsR0FBRyxDQUFDLG1DQUFtQyxDQUFDLENBQUM7U0FDbEQ7SUFDSCxDQUFDOzs7Ozs7O0lBRU8sc0RBQW1COzs7Ozs7SUFBM0IsVUFBNEIsWUFBMkIsRUFBRSxLQUFvQjtRQUMzRSxJQUFJOztnQkFDSSxrQkFBa0IsR0FBRyxZQUFZLENBQUMsTUFBTTs7OztZQUFDLFVBQUMsR0FBRyxJQUFLLE9BQUEsR0FBRyxDQUFDLFdBQVcsQ0FBQyxPQUFPLEVBQUUsSUFBSSxLQUFLLENBQUMsYUFBYSxDQUFDLE9BQU8sRUFBRSxFQUExRCxDQUEwRCxFQUFDOztnQkFDN0csc0JBQXNCLEdBQUcsa0JBQWtCLENBQUMsTUFBTTs7OztZQUFDLFVBQUMsR0FBRzs7b0JBQ3JELG9CQUFvQixHQUFHLElBQUksSUFBSSxDQUFDLEdBQUcsQ0FBQyxXQUFXLENBQUMsT0FBTyxFQUFFLENBQUM7Z0JBQ2hFLG9CQUFvQixDQUFDLE9BQU8sQ0FBQyxvQkFBb0IsQ0FBQyxPQUFPLEVBQUUsR0FBRyxDQUFDLENBQUMsQ0FBQztnQkFDakUsT0FBTyxvQkFBb0IsQ0FBQyxPQUFPLEVBQUUsSUFBSSxLQUFLLENBQUMsV0FBVyxDQUFDLE9BQU8sRUFBRSxDQUFDO1lBQ3ZFLENBQUMsRUFBQztZQUNGLHNCQUFzQixDQUFDLE9BQU87Ozs7WUFBQyxVQUFDLEdBQUc7Z0JBQ2pDLEdBQUcsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO1lBQ3pCLENBQUMsRUFBQyxDQUFDO1NBQ0o7UUFBQyxPQUFPLENBQUMsRUFBRTtZQUNWLE9BQU8sQ0FBQyxHQUFHLENBQUMsa0NBQWtDLENBQUMsQ0FBQztTQUNqRDtJQUNILENBQUM7O2dCQXBLRixVQUFVLFNBQUM7b0JBQ1YsVUFBVSxFQUFFLE1BQU07aUJBQ25COzs7OzttQ0FMRDtDQXdLQyxBQXJLRCxJQXFLQztTQWxLWSx3QkFBd0I7OztJQUtuQyxrREFBeUY7O0lBRXpGLHNEQUF3Rjs7SUFFeEYscURBQXNIOztJQXFCdEgsb0RBQTJIIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHtDYWxlbmRhckRheSwgQ2FsZW5kYXJFdmVudCwgbW9udGhzfSBmcm9tICcuL2RhdGEtbW9kZWxzL2RhdGEtY2FsZW5kYXInO1xuXG5ASW5qZWN0YWJsZSh7XG4gIHByb3ZpZGVkSW46ICdyb290J1xufSlcbmV4cG9ydCBjbGFzcyBOZ3hTaW1wbGVDYWxlbmRhclNlcnZpY2Uge1xuXG4gIGNvbnN0cnVjdG9yKCkge1xuICB9XG5cbiAgZ2V0RGF5c0luTW9udGggPSAobW9udGg6IG51bWJlciwgeWVhcjogbnVtYmVyKSA9PiBuZXcgRGF0ZSh5ZWFyLCBtb250aCArIDEsIDApLmdldERhdGUoKTtcblxuICBnZXRGaXJzdERheUluTW9udGggPSAobW9udGg6IG51bWJlciwgeWVhcjogbnVtYmVyKSA9PiBuZXcgRGF0ZSh5ZWFyLCBtb250aCwgMSkuZ2V0RGF5KCk7XG5cbiAgZ2V0TGFzdERheUluTW9udGggPSAobW9udGg6IG51bWJlciwgeWVhcjogbnVtYmVyKSA9PiBuZXcgRGF0ZSh5ZWFyLCBtb250aCwgdGhpcy5nZXREYXlzSW5Nb250aChtb250aCwgeWVhcikpLmdldERheSgpO1xuXG4gIHNldHVwQ2FsZW5kYXIobW9udGg6IG51bWJlciwgeWVhcjogbnVtYmVyLCBldmVudHM6IENhbGVuZGFyRXZlbnRbXSk6IENhbGVuZGFyRGF5W10ge1xuICAgIGNvbnN0IGZpcnN0RGF5SW5Nb250aCA9IHRoaXMuZ2V0Rmlyc3REYXlJbk1vbnRoKG1vbnRoLCB5ZWFyKTtcbiAgICBjb25zdCBsYXN0RGF5SW5Nb250aCA9IHRoaXMuZ2V0TGFzdERheUluTW9udGgobW9udGgsIHllYXIpO1xuXG4gICAgY29uc3QgZGF5c0Zyb21MYXN0TW9udGggPSB0aGlzLmdldERheXNGcm9tTGFzdE1vbnRoKG1vbnRoLCB5ZWFyLCBmaXJzdERheUluTW9udGgpO1xuICAgIGNvbnN0IGRheXNGcm9tQ3VycmVudE1vbnRoID0gdGhpcy5nZXREYXlzSW5DdXJyZW50TW9udGgobW9udGgsIHllYXIpO1xuICAgIGNvbnN0IGRheXNGcm9tTmV4dE1vbnRoID0gdGhpcy5nZXREYXlzRnJvbU5leHRNb250aChtb250aCwgeWVhciwgbGFzdERheUluTW9udGgpO1xuXG4gICAgY29uc3QgY2FsZW5kYXJEYXRhID0gWy4uLmRheXNGcm9tTGFzdE1vbnRoLCAuLi5kYXlzRnJvbUN1cnJlbnRNb250aCwgLi4uZGF5c0Zyb21OZXh0TW9udGhdO1xuXG4gICAgdGhpcy5tYXJrQ3VycmVudERhdGUoY2FsZW5kYXJEYXRhKTtcblxuICAgIGlmIChldmVudHMpIHtcbiAgICAgIHRoaXMuYWRkRXZlbnRzKGNhbGVuZGFyRGF0YSwgZXZlbnRzKTtcbiAgICB9XG5cbiAgICByZXR1cm4gY2FsZW5kYXJEYXRhO1xuICB9XG5cbiAgZ2V0TW9udGhZZWFyVGV4dCA9IChtb250aE51bWJlcjogbnVtYmVyLCB5ZWFyOiBudW1iZXIpID0+IGAke21vbnRocy5maW5kKChpdGVtKSA9PiBpdGVtLmlkID09PSBtb250aE51bWJlcikubmFtZX0gJHt5ZWFyfWA7XG5cbiAgcHJpdmF0ZSBnZXREYXlzRnJvbUxhc3RNb250aChtb250aDogbnVtYmVyLCB5ZWFyOiBudW1iZXIsIGZpcnN0RGF5SW5Nb250aDogbnVtYmVyKTogQ2FsZW5kYXJEYXlbXSB7XG4gICAgbGV0IGxhc3RNb250aCwgYWN0aXZlWWVhcjtcbiAgICBjb25zdCBsYXN0TW9udGhEYXlzID0gW107XG4gICAgaWYgKChtb250aCAtIDEpID09PSAtMSkge1xuICAgICAgbGFzdE1vbnRoID0gMTE7XG4gICAgICBhY3RpdmVZZWFyID0geWVhciAtIDE7XG4gICAgfSBlbHNlIHtcbiAgICAgIGxhc3RNb250aCA9IG1vbnRoIC0gMTtcbiAgICAgIGFjdGl2ZVllYXIgPSB5ZWFyO1xuICAgIH1cblxuICAgIGNvbnN0IGRheXNMYXN0TW9udGggPSB0aGlzLmdldERheXNJbk1vbnRoKGxhc3RNb250aCwgYWN0aXZlWWVhcik7XG4gICAgY29uc3QgbGFzdEZyb21Nb250aCA9IChmaXJzdERheUluTW9udGggPT09IDApID8gNiA6IGZpcnN0RGF5SW5Nb250aCAtIDE7XG5cbiAgICBmb3IgKGxldCBpID0gKGRheXNMYXN0TW9udGggLSBsYXN0RnJvbU1vbnRoKSArIDE7IGkgPD0gZGF5c0xhc3RNb250aDsgaSsrKSB7XG4gICAgICBsYXN0TW9udGhEYXlzLnB1c2godGhpcy5nZW5lcmF0ZWRheU9iamVjdChhY3RpdmVZZWFyLCBsYXN0TW9udGgsIGksIGZhbHNlKSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIGxhc3RNb250aERheXM7XG4gIH1cblxuICBwcml2YXRlIGdldERheXNJbkN1cnJlbnRNb250aChtb250aCwgeWVhcik6IENhbGVuZGFyRGF5W10ge1xuICAgIGNvbnN0IGRheXNJbk1vbnRoID0gdGhpcy5nZXREYXlzSW5Nb250aChtb250aCwgeWVhcik7XG4gICAgY29uc3QgY3VycmVudE1vbnRoRGF5cyA9IFtdO1xuXG4gICAgZm9yIChsZXQgaSA9IDE7IGkgPD0gZGF5c0luTW9udGg7IGkrKykge1xuICAgICAgY3VycmVudE1vbnRoRGF5cy5wdXNoKHRoaXMuZ2VuZXJhdGVkYXlPYmplY3QoeWVhciwgbW9udGgsIGkpKTtcbiAgICB9XG5cbiAgICByZXR1cm4gY3VycmVudE1vbnRoRGF5cztcbiAgfVxuXG4gIHByaXZhdGUgZ2V0RGF5c0Zyb21OZXh0TW9udGgobW9udGg6IG51bWJlciwgeWVhcjogbnVtYmVyLCBsYXN0RGF5SW5Nb250aDogbnVtYmVyKTogQ2FsZW5kYXJEYXlbXSB7XG4gICAgbGV0IG5leHRNb250aCwgYWN0aXZlWWVhcjtcblxuICAgIGNvbnN0IGxhc3RNb250aERheXMgPSBbXTtcbiAgICBpZiAoKG1vbnRoICsgMSkgPT09IDEyKSB7XG4gICAgICBuZXh0TW9udGggPSAwO1xuICAgICAgYWN0aXZlWWVhciA9IHllYXIgKyAxO1xuICAgIH0gZWxzZSB7XG4gICAgICBuZXh0TW9udGggPSBtb250aCArIDE7XG4gICAgICBhY3RpdmVZZWFyID0geWVhcjtcbiAgICB9XG5cbiAgICBjb25zdCBsYXN0RnJvbU1vbnRoID0gKGxhc3REYXlJbk1vbnRoID09PSAwKSA/IDAgOiA3IC0gbGFzdERheUluTW9udGg7XG5cbiAgICBmb3IgKGxldCBpID0gMTsgaSA8PSBsYXN0RnJvbU1vbnRoOyBpKyspIHtcbiAgICAgIGxhc3RNb250aERheXMucHVzaCh0aGlzLmdlbmVyYXRlZGF5T2JqZWN0KGFjdGl2ZVllYXIsIG5leHRNb250aCwgaSwgZmFsc2UpKTtcbiAgICB9XG5cbiAgICByZXR1cm4gbGFzdE1vbnRoRGF5cztcbiAgfVxuXG4gIHByaXZhdGUgbWFya0N1cnJlbnREYXRlKGNhbGVuZGFyRGF0YTogQ2FsZW5kYXJEYXlbXSkge1xuICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKCk7XG4gICAgY29uc3QgdG9kYXlzRGF0ZSA9IG5vdy5nZXREYXRlKCk7XG4gICAgY29uc3QgdG9kYXlzTW9udGggPSBub3cuZ2V0TW9udGgoKTtcbiAgICBjb25zdCB0b2RheXNZZWFyID0gbm93LmdldEZ1bGxZZWFyKCk7XG5cbiAgICBjYWxlbmRhckRhdGEuZm9yRWFjaCgoZGF5KSA9PiB7XG4gICAgICBpZiAoZGF5Lm51bWJlciA9PT0gdG9kYXlzRGF0ZSAmJiBkYXkubW9udGggPT09IHRvZGF5c01vbnRoICYmIGRheS55ZWFyID09PSB0b2RheXNZZWFyKSB7XG4gICAgICAgIGRheS50b2RheSA9IHRydWU7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICBwcml2YXRlIGlzV2Vla2VuZChkYXRlOiBEYXRlKSB7XG4gICAgY29uc3QgbnVtYmVyRGF5ID0gZGF0ZS5nZXREYXkoKTtcbiAgICByZXR1cm4gbnVtYmVyRGF5ID09PSAwIHx8IG51bWJlckRheSA9PT0gNjtcbiAgfVxuXG4gIHByaXZhdGUgZ2V0RGF0ZVRpbWVMYXN0T2ZEYXkoZGF0ZVRpbWU6IERhdGUpIHtcbiAgICBjb25zdCByZXN1bHQgPSBuZXcgRGF0ZShkYXRlVGltZS5nZXRUaW1lKCkpO1xuICAgIHJlc3VsdC5zZXREYXRlKHJlc3VsdC5nZXREYXRlKCkgKyAxKTtcbiAgICByZXN1bHQuc2V0TWlsbGlzZWNvbmRzKHJlc3VsdC5nZXRNaWxsaXNlY29uZHMoKSAtIDEpO1xuICAgIHJldHVybiByZXN1bHQ7XG4gIH1cblxuICBnZW5lcmF0ZWRheU9iamVjdCh5ZWFyOiBudW1iZXIsIG1vbnRoOiBudW1iZXIsIGRheTogbnVtYmVyLCBhY3RpdmVNb250aDogYm9vbGVhbiA9IHRydWUpIHtcbiAgICBjb25zdCBzdGFydERhdGVUaW1lID0gbmV3IERhdGUoeWVhciwgbW9udGgsIGRheSk7XG4gICAgY29uc3QgZW5kRGF0ZVRpbWUgPSB0aGlzLmdldERhdGVUaW1lTGFzdE9mRGF5KHN0YXJ0RGF0ZVRpbWUpO1xuICAgIHJldHVybiB7XG4gICAgICBudW1iZXI6IGRheSxcbiAgICAgIHN0YXJ0RGF0ZVRpbWUsXG4gICAgICBlbmREYXRlVGltZSxcbiAgICAgIG1vbnRoOiBzdGFydERhdGVUaW1lLmdldE1vbnRoKCksXG4gICAgICB5ZWFyOiBzdGFydERhdGVUaW1lLmdldEZ1bGxZZWFyKCksXG4gICAgICB3ZWVrZW5kOiB0aGlzLmlzV2Vla2VuZChzdGFydERhdGVUaW1lKSxcbiAgICAgIHRvZGF5OiBmYWxzZSxcbiAgICAgIGFjdGl2ZU1vbnRoLFxuICAgICAgZXZlbnRzOiBbXVxuICAgIH07XG4gIH1cblxuICBwcml2YXRlIGFkZEV2ZW50cyhjYWxlbmRhckRhdGE6IENhbGVuZGFyRGF5W10sIGV2ZW50czogQ2FsZW5kYXJFdmVudFtdKSB7XG4gICAgZXZlbnRzLmZvckVhY2goKGV2ZW50OiBDYWxlbmRhckV2ZW50KSA9PiB7XG4gICAgICBpZiAoIWV2ZW50LmVuZERhdGVUaW1lKSB7XG4gICAgICAgIHRoaXMuaGFuZGxlRnVsbERheUV2ZW50KGNhbGVuZGFyRGF0YSwgZXZlbnQpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5oYW5kbGVFdmVudEludGVydmFsKGNhbGVuZGFyRGF0YSwgZXZlbnQpO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSBoYW5kbGVGdWxsRGF5RXZlbnQoY2FsZW5kYXJEYXRhOiBDYWxlbmRhckRheVtdLCBldmVudDogQ2FsZW5kYXJFdmVudCkge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBkYXlXaXRoRXZlbnQgPSBjYWxlbmRhckRhdGEuZmluZCgoZGF5KSA9PiB7XG4gICAgICAgIHJldHVybiBkYXkuc3RhcnREYXRlVGltZS5nZXRUaW1lKCkgPD0gZXZlbnQuc3RhcnREYXRlVGltZS5nZXRUaW1lKCkgJiYgZGF5LmVuZERhdGVUaW1lLmdldFRpbWUoKSA+PSBldmVudC5zdGFydERhdGVUaW1lLmdldFRpbWUoKTtcbiAgICAgIH0pO1xuICAgICAgZGF5V2l0aEV2ZW50LmV2ZW50cy5wdXNoKGV2ZW50KTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICBjb25zb2xlLmxvZygnc3RhcnREYXRlVGltZSBvbiBldmVudCBpcyBub3Qgc2V0Jyk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBoYW5kbGVFdmVudEludGVydmFsKGNhbGVuZGFyRGF0YTogQ2FsZW5kYXJEYXlbXSwgZXZlbnQ6IENhbGVuZGFyRXZlbnQpIHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgZnJvbURheXNJbkNhbGVuZGFyID0gY2FsZW5kYXJEYXRhLmZpbHRlcigoZGF5KSA9PiBkYXkuZW5kRGF0ZVRpbWUuZ2V0VGltZSgpID49IGV2ZW50LnN0YXJ0RGF0ZVRpbWUuZ2V0VGltZSgpKTtcbiAgICAgIGNvbnN0IGludGVydmFsRGF5c0luQ2FsZW5kYXIgPSBmcm9tRGF5c0luQ2FsZW5kYXIuZmlsdGVyKChkYXkpID0+IHtcbiAgICAgICAgY29uc3QgeWVzdGVyRGF5UmVmZXJlbnREYXkgPSBuZXcgRGF0ZShkYXkuZW5kRGF0ZVRpbWUuZ2V0VGltZSgpKTtcbiAgICAgICAgeWVzdGVyRGF5UmVmZXJlbnREYXkuc2V0RGF0ZSh5ZXN0ZXJEYXlSZWZlcmVudERheS5nZXREYXRlKCkgLSAxKTtcbiAgICAgICAgcmV0dXJuIHllc3RlckRheVJlZmVyZW50RGF5LmdldFRpbWUoKSA8PSBldmVudC5lbmREYXRlVGltZS5nZXRUaW1lKCk7XG4gICAgICB9KTtcbiAgICAgIGludGVydmFsRGF5c0luQ2FsZW5kYXIuZm9yRWFjaCgoZGF5KSA9PiB7XG4gICAgICAgIGRheS5ldmVudHMucHVzaChldmVudCk7XG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICBjb25zb2xlLmxvZygnRXJyb3Igb24gaGFuZGxpbmcgZXZlbnQgaW50ZXJ2YWwnKTtcbiAgICB9XG4gIH1cbn1cbiJdfQ==